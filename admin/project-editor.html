<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Editor | Admin Console</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../frontend/js/config.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], display: ['Space Grotesk', 'sans-serif'] },
                    colors: {
                        glass: { dark: 'rgba(10, 10, 20, 0.6)', border: 'rgba(255, 255, 255, 0.15)' },
                        neon: { blue: '#4F46E5', purple: '#A855F7', cyan: '#06B6D4', green: '#10B981', red: '#EF4444', gold: '#F59E0B' }
                    }
                }
            }
        }
    </script>
    <style>
        body { background: #0f172a; color: white; }
        .ambient-bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 10% 10%, rgba(245, 158, 11, 0.1), transparent 40%); }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-input { background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); color: white; }
        .glass-input:focus { border-color: #F59E0B; outline: none; }
    </style>
</head>
<body class="flex items-center justify-center min-h-[100vh] p-4">
    <div class="ambient-bg"></div>

    <div class="glass-panel w-full max-w-2xl rounded-2xl p-8 shadow-2xl relative">
        <a href="index.html" class="absolute top-8 right-8 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></a>
        
        <h1 class="text-3xl font-display font-bold mb-2">Project Editor</h1>
        <p class="text-gray-400 text-sm mb-8">Showcase student innovations and team projects.</p>

        <form id="project-form" class="space-y-6">
            <!-- Hidden ID -->
            <input type="hidden" id="project-id">

            <!-- Title & Team -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-bold">Project Title</label>
                    <input type="text" id="title" required class="w-full glass-input rounded-lg p-3 text-sm" placeholder="e.g. Solar Drone">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-bold">Team Members</label>
                    <input type="text" id="teamMembers" required class="w-full glass-input rounded-lg p-3 text-sm" placeholder="e.g. Alice, Bob, Charlie">
                </div>
            </div>

            <!-- Description -->
            <div class="space-y-2">
                <label class="text-xs text-gray-500 uppercase font-bold">Short Description</label>
                <textarea id="description" rows="3" required class="w-full glass-input rounded-lg p-3 text-sm resize-none" placeholder="Brief elevator pitch..."></textarea>
            </div>

            <!-- Links & Tags -->
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-bold">Project Link (GitHub/Demo)</label>
                    <input type="url" id="link" class="w-full glass-input rounded-lg p-3 text-sm" placeholder="https://...">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-bold">Tech Tags</label>
                    <input type="text" id="tags" class="w-full glass-input rounded-lg p-3 text-sm" placeholder="e.g. IoT, AI, Python">
                </div>
            </div>

             <!-- Image -->
             <div class="space-y-2">
                <label class="text-xs text-gray-500 uppercase font-bold">Thumbnail URL</label>
                <div class="flex gap-2">
                    <input type="url" id="thumbnail" class="w-full glass-input rounded-lg p-3 text-sm" placeholder="https://images.unsplash.com/...">
                    <button type="button" onclick="previewImage()" class="px-4 py-2 bg-white/5 rounded-lg hover:bg-white/10 text-xs font-bold uppercase">Preview</button>
                </div>
                <div id="image-preview" class="hidden mt-2 rounded-lg overflow-hidden h-40 border border-white/10">
                    <img src="" class="w-full h-full object-cover">
                </div>
            </div>

            <!-- Actions -->
            <div class="flex justify-end gap-4 pt-4 border-t border-white/5">
                <button type="button" onclick="window.history.back()" class="px-6 py-3 rounded-xl text-gray-400 font-bold hover:text-white transition-colors">Cancel</button>
                <button type="submit" class="px-8 py-3 rounded-xl bg-neon-gold hover:bg-amber-400 text-black font-bold shadow-lg shadow-amber-500/20 transition-all flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i> Save Project
                </button>
            </div>
        </form>
    </div>

    <script>
        lucide.createIcons();

        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');

        // Load Data if Edit Mode
        if (projectId) {
            document.getElementById('project-id').value = projectId;
            loadProject(projectId);
        }

        async function loadProject(id) {
            try {
                const res = await fetch(`${CONFIG.API_BASE_URL}/projects/${id}`);
                const data = await res.json();
                
                document.getElementById('title').value = data.title;
                document.getElementById('teamMembers').value = data.teamMembers;
                document.getElementById('description').value = data.description;
                document.getElementById('link').value = data.link || '';
                document.getElementById('tags').value = data.tags || '';
                document.getElementById('thumbnail').value = data.thumbnail;
                previewImage();
            } catch (err) { console.error(err); }
        }

        function previewImage() {
            const url = document.getElementById('thumbnail').value;
            const container = document.getElementById('image-preview');
            const img = container.querySelector('img');
            if(url) {
                img.src = url;
                container.classList.remove('hidden');
            }
        }

        // Save Logic
        document.getElementById('project-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerHTML = 'Saving...';
            
            const payload = {
                title: document.getElementById('title').value,
                teamMembers: document.getElementById('teamMembers').value,
                description: document.getElementById('description').value,
                link: document.getElementById('link').value,
                tags: document.getElementById('tags').value,
                thumbnail: document.getElementById('thumbnail').value || 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?auto=format&fit=crop&q=80'
            };

            try {
                const id = document.getElementById('project-id').value;
                const url = id ? `${CONFIG.API_BASE_URL}/projects/${id}` : `${CONFIG.API_BASE_URL}/projects`;
                const method = id ? 'PUT' : 'POST';

                const res = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    window.location.href = 'index.html';
                } else {
                    alert('Error saving project');
                }
            } catch (err) {
                console.error(err);
                alert('Connection error');
            } finally {
                btn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Save Project';
            }
        });
    </script>
</body>
</html>
